/*
 * File:   newmain.c
 * Author: mike
 *
 * Created on 14 January 2016, 11:07 PM
 */

#include <pic18f2455.h>
//#include <delays.h>
#include "config.h"

//unsigned long patterns[] = {
//    0b1111111111111111,
//    0b1111111001111111,
//    0b1111110000111111,
//    0b1111100000011111,
//    0b1111000000001111,
//    0b1110000000000111,
//    0b1100000000000011,
//    0b1110000000000111,
//    0b1111000000001111,
//    0b1111100000011111,
//    0b1111110000111111,
//    0b1111111001111111
//};
unsigned long patterns[][32] = {
    {
    0b00000000000000000000000000000000,
    0b00000000000000000000000000000000,
    0b00000000000000011000000000000000,
    0b00000000000000111100000000000000,
    0b00000000000001111110000000000000,
    0b00000000000011111111000000000000,
    0b00000000000111111111100000000000,
    0b00000000001111111111110000000000,
    0b00000000011111111111111000000000,
    0b00000000111111111111111100000000,
    0b00000001111111111111111110000000,
    0b00000011111111111111111111000000,
    0b00001111111111111111111111100000,
    0b00011111111111111111111111110000,
    0b00111111111111111111111111111000,
    0b00111111111111111111111111111100,
    0b00011111111111111111111111110000,
    0b00001111111111111111111111100000,
    0b00000011111111111111111111000000,
    0b00000001111111111111111110000000,
    0b00000000000000011000000000000000,
    0b00000000000000111100000000000000,
    0b00000000000001111110000000000000,
    0b00000000000011111111000000000000,
    0b00000000000111111111100000000000,
    0b00000000001111111111110000000000,
    0b00000000011111111111111000000000,
    0b00000000111111111111111100000000,
    0b00000000000000000000000000000000,
    0b00000000000000000000000000000000,
    0b00000000000000000000000000000000,
    0b00000000000000000000000000000000,
    },
    {
    0b00000000000000000000000000000000,
    0b00000000000000000000000000000000,
    0b00000000000000000000000000000000,
    0b00000000000000000000000000000000,
    0b00000000000000000000000000000000,
    0b00000000000000000000000000000000,
    0b00000000000000000000000000000000,
    0b00000000000000000000000000000000,
    0b00000000000000000000000000000000,
    0b00000000000000000000000000000000,
    0b00111111111111111111111111111100,
    0b00111111111111111111111111111100,
    0b00111111111111111111111111111100,
    0b00111111111111111111111111111100,
    0b00111100000000111100000001111100,
    0b00111100000000111100000001111100,
    0b00111100000000111100000001111100,
    0b00111100000000111100000001111100,
    0b00111100000000111100000001111100,
    0b00111100000000111100000001111100,
    0b00111100000000111100000001111100,
    0b00111100000000111100000001111100,
    0b00111100000000111100000001111100,
    0b00000000000000000000000000000000,
    0b00000000000000000000000000000000,
    0b00000000000000000000000000000000,
    0b00000000000000000000000000000000,
    0b00000000000000000000000000000000,
    0b00000000000000000000000000000000,
    0b00000000000000000000000000000000,
    0b00000000000000000000000000000000,
    },
    {
    0b00000000000000000000000000000000,
    0b00000000000000000000000000000000,
    0b00000000000000000000000000000000,
    0b00000000000000000000000000000000,
    0b00000000000000000000000000000000,
    0b00000000000000000000000000000000,
    0b00111111111111111111111111111100,
    0b00111111111111111111111111111100,
    0b00111111111111111111111111111100,
    0b00111111111111111111111111111100,
    0b00000000000000111100000000111100,
    0b00000000000000111100000000111100,
    0b00000000000000111100000000111100,
    0b00000000000000111100000000111100,
    0b00000000000000111100000000111100,
    0b00000000000000111100000000111100,
    0b00000000000000111100000000111100,
    0b00111111111111111111111111111100,
    0b00111111111111111111111111111100,
    0b00111111111111111111111111111100,
    0b00111111111111111111111111111100,
    0b00000000000000000000000000000000,
    0b00000000000000000000000000000000,
    0b00000000000000000000000000000000,
    0b00000000000000000000000000000000,
    0b00000000000000000000000000000000,
    0b00000000000000000000000000000000,
    0b00000000000000000000000000000000,
    0b00000000000000000000000000000000,
    0b00000000000000000000000000000000,
    0b00000000000000000000000000000000,
    0b00000000000000000000000000000000,
        },
    {
    0b00000000000000000000000000000000,
    0b00000000000000000000000000000000,
    0b00000000000000000000000001111100,
    0b00000000000000000000000001111100,
    0b00000000000000000000000001111100,
    0b00000000000000000000000001111100,
    0b00000000000000000000000001111100,
    0b00000000000000000000000001111100,
    0b00000000000000000000000001111100,
    0b00000000000000000000000001111100,
    0b00000000000000000000000001111100,
    0b00000000000000000000000001111100,
    0b00000000000000000000000001111100,
    0b00000000000000000000000001111100,
    0b00111111111111111111111111111100,
    0b00111111111111111111111111111100,
    0b00111111111111111111111111111100,
    0b00111111111111111111111111111100,
    0b00111111111111111111111111111100,
    0b00000000000000000000000001111100,
    0b00000000000000000000000001111100,
    0b00000000000000000000000001111100,
    0b00000000000000000000000001111100,
    0b00000000000000000000000001111100,
    0b00000000000000000000000001111100,
    0b00000000000000000000000001111100,
    0b00000000000000000000000001111100,
    0b00000000000000000000000001111100,
    0b00000000000000000000000001111100,
    0b00000000000000000000000001111100,
    0b00000000000000000000000000000000,
    0b00000000000000000000000000000000,
    },
    {
    0b00000000000000000000000000000000,
    0b00000000000000000000000000000000,
    0b00000000000000011000000000000000,
    0b00000000000000111100000000000000,
    0b00000000000001111110000000000000,
    0b00000000000011111111000000000000,
    0b00000000000111111111100000000000,
    0b00000000001111111111110000000000,
    0b00000000011111111111111000000000,
    0b00000000111111111111111100000000,
    0b00000001111111111111111110000000,
    0b00000011111111111111111111000000,
    0b00001111111111111111111111100000,
    0b00011111111111111111111111110000,
    0b00111111111111111111111111111000,
    0b00111111111111111111111111111100,
    0b00011111111111111111111111110000,
    0b00001111111111111111111111100000,
    0b00000011111111111111111111000000,
    0b00000001111111111111111110000000,
    0b00000000111111111111111100000000,
    0b00000000011111111111111000000000,
    0b00000000001111111111110000000000,
    0b00000000000111111111100000000000,
    0b00000000000011111111000000000000,
    0b00000000000001111110000000000000,
    0b00000000000000111100000000000000,
    0b00000000000000011000000000000000,
    0b00000000000000000000000000000000,
    0b00000000000000000000000000000000,
    0b00000000000000000000000000000000,
    0b00000000000000000000000000000000,
    },
};

unsigned long update_leds(unsigned long pattern_group_index, unsigned long pattern_index) {
//    if(leds <= 0b0000000000000011) {
//        leds = 0b0000000000000110;
//        *direction = 1;
//    } else if(leds >= 0b1100000000000000) {
//        *direction = 0;
//        leds = 0b0110000000000000;
//    }
//    
//    if(*direction == 0) {
//        leds = (leds >> 1);
//    } else {
//        leds = (leds << 1);
//    }
//   
//    return leds;
    
    return patterns[pattern_group_index][pattern_index];
}

void delay(int delay) {
    for(int i = 0; i < delay; i++) {
        
    }
}

void main(void) {
    TRISA=0;
    TRISB=0;
    TRISC=0;
    PORTA=0xff;
    PORTB=0xff;
    PORTC=0xff;
    
    ADCON1=0b00001111;
    T1CONbits.TMR1CS = 0;
    T1CONbits.T1OSCEN = 0;
    
//    PORTE=0xff;
        
   
//    PORTAbits.RA0 = 1;
//    PORTAbits.RA1 = 0;
//    PORTAbits.RA2 = 1;
//    PORTAbits.RA3 = 0;
//    PORTAbits.RA4 = 1;
//    PORTAbits.RA5 = 0;
//    PORTAbits.RA6 = 1;
//    PORTAbits.RA7 = 03;
    
//    PORTB=0;
//    PORTA=0;
////    update_leds();
//    
//    PORTB=0xf;
    
    unsigned int direction = 1;
    unsigned long leds = 0b0000000000000011;

    unsigned long pattern_index = 0;
    unsigned long pattern_group_index = 0;
    
    while(1) {
        leds = update_leds(pattern_group_index, pattern_index++);
        if(pattern_index >=32) {
            pattern_index = 0;
            pattern_group_index++;
        }
        if(pattern_group_index >= 4) {
            pattern_group_index = 0;
        }
        
        unsigned char porta = (leds >> 24) & 0xff;
        unsigned char portb = (leds >> 16) & 0xff;
        unsigned char portc = (leds >> 8) & 0xff;
        unsigned char portd = leds & 0xff;
        
        // clock out the porta into the shift register
        for(int i = 0; i < 8; i++) {
            PORTAbits.RA0 = porta & 0x01;
            PORTAbits.RA1 = portb & 0x01;
            PORTAbits.RA2 = portc & 0x01;
            PORTAbits.RA3 = portd & 0x01;
            delay(2);
            PORTAbits.RA4 = 1;
            delay(5);
            PORTAbits.RA4 = 0;
            delay(5);
            
            porta = (porta >> 1);
            portb = (portb >> 1);
            portc = (portc >> 1);
            portd = (portd >> 1);
        }
        
        PORTAbits.RA5 = 1;
        delay(5);
        PORTAbits.RA5 = 0;

        delay(150);
    }
 
    return;
}
